{% extends 'blog/base.html' %}
{% block primary %}
<button type="button" id="btnPizza" class="btn btn-info" style ="float:right;margin-bottom:20px;"> Download Spreadsheet</button>
{% include "blog/filter_row.html" %}
<div id="table_wrapper">
  <table class='table table-striped table-bordered tablesorter' id="backlog_table">
    <thead>
      <tr>
        <th> State </th>
        <th> StoryID </th>
        <th> Name </th>
        <th> Opened </th>
        <th> Owner </th>
        <th> Blocked</th>
      </tr>
  </thead>
  <tbody>
      {% for story in stories %}
      <tr>
        <td class='{{story.State}}'>{{story.State}}</td>
        <td>{{story.id}}</td>
        <td>{{story.name}}</td>
        <td>{{story.Opened|default:"unassigned"}}</td>
        <td>{{story.Requester}}</td>
        <td>{{story.Blocked}}</td>

      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script type="text/javascript">
$(document).ready(function(){
  $("#backlog_table").tablesorter();
  $('.filter-button').on('click', function(){
     $('.filter-button').removeClass('selected');
     $(this).addClass('selected');
     var clickedBtn = $(this).attr('id');
     var rowSelected = $('.'+clickedBtn).parent();
     if(clickedBtn != 'all'){
       $('tbody tr ').hide();
       rowSelected.show();
     }
     else{
       $('tbody tr ').show();
     }
   });
$('#btnPizza').click(function(e) {
e.preventDefault();

var data_type = 'data:application/vnd.ms-excel';
var table_div = document.getElementById('table_wrapper');
var table_html = table_div.outerHTML.replace(/ /g, '%20');

var a = document.createElement('a');
a.href = data_type + ', ' + table_html;
a.download = 'exported_table_.xls';
a.click();
});
});
</script>
{% endblock %}
